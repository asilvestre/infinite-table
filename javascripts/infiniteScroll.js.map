{"version":3,"sources":["infiniteScroll.es6"],"names":[],"mappings":"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","file":"infiniteScroll.js","sourcesContent":["/**\n *  sails_again\n * Author: michael\n * Date: 28.09.15.\n * License: MIT\n */\n\nvar _ = require('lodash');\nvar Promise = require('bluebird');\n\nHTMLTableCellElement.prototype.setDataAttribute = function (data, attributes) {\n    if (!data || !attributes) return this;\n    Object.keys(attributes).forEach(val => {\n        let re = /:(.*):/;\n        if (attributes[val].match(re)) {\n            this.setAttribute('data-' + val, attributes[val].replace(re, data[attributes[val].match(re)[1]]));\n        }\n    });\n    return this;\n};\n\nexport default class InfiniteScroll {\n    constructor(el, options = {}) {\n        if (! (options.fields || options.url)) throw new Error('missing parameter ' + (options.fields ? 'url' : 'fields') + '!');\n        this.element = el;\n        this.options = Object.assign({\n            perPage: 20,\n            loadTiming: 2,\n            autoload: true,\n            transport: 'ajax',\n            spinner: 0\n        }, options);\n        this.page = 0;\n        this.loaderSpinners = [\n            `<div class=\"spinner3\">\n                                <div class=\"bounce1\"></div>\n                                <div class=\"bounce2\"></div>\n                                <div class=\"bounce3\"></div>\n                              </div>`,\n            `<div class=\"spinner2\">\n                                <div class=\"cube1\"></div>\n                                <div class=\"cube2\"></div>\n                              </div>`,\n            `<div class=\"spinner\">\n                                <div class=\"rect1\"></div>\n                                <div class=\"rect2\"></div>\n                                <div class=\"rect3\"></div>\n                                <div class=\"rect4\"></div>\n                                <div class=\"rect5\"></div>\n                              </div>`\n        ];\n        if (this.options.spinner !== false) {\n            let spinner = document.createElement('div');\n            spinner.innerHTML = this.loaderSpinners[this.options.spinner];\n            document.getElementById(this.element).parentNode.appendChild(spinner);\n        }\n        this.elementToWatch = document.getElementById(el).rows[document.getElementById(el).rows.length - this.options.loadTiming];\n        if (!this.elementToWatch) {\n            this[this.options.transport]();\n        } else {\n            window.addEventListener('load', this.handler.bind(this), false);\n            this.setupListener();\n        }\n    }\n\n    setupListener() {\n        this.listener = () => {\n            _.defer(this.handler.bind(this));\n        };\n        window.addEventListener('resize', this.listener, false);\n        window.addEventListener('scroll', this.listener, false);\n    }\n\n    removeListener() {\n        window.removeEventListener('resize', this.listener, false);\n        window.removeEventListener('scroll', this.listener, false);\n    }\n\n    static isElementInViewport(el) {\n        let rect = el.getBoundingClientRect();\n        return (\n            rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&\n            rect.right <= (window.innerWidth || document.documentElement.clientWidth)\n        );\n    }\n\n    handler() {\n        if (InfiniteScroll.isElementInViewport(this.elementToWatch)) {\n            Promise.resolve(this.removeListener())\n                .then(() => {\n                    this[this.options.transport]();\n                });\n        }\n    }\n\n    recordsToFetch() {\n        let recordsToFetchStart = this.page * this.options.perPage;\n        let recordsToFetchEnd = recordsToFetchStart + this.options.perPage;\n        return [recordsToFetchStart, recordsToFetchEnd];\n    }\n\n    ajax() {\n        let records = this.recordsToFetch();\n        var xhr = new XMLHttpRequest();\n        xhr.open('GET', `${this.options.url}?skip=${records[0]}&limit=${records[1]}`, true);\n        xhr.onreadystatechange = () => {\n            if (xhr.readyState !== 4) return;\n            if (xhr.status !== 200) return;\n            this.handleResponse(JSON.parse(xhr.responseText));\n        };\n        xhr.send();\n    }\n\n    sockets() {\n        let records = this.recordsToFetch();\n        if (! io) throw new Error('No socket driver found');\n        io.socket.get(`${this.options.url}?skip=${records[0]}&limit=${records[1]}`, result => {\n            this.handleResponse(result);\n        })\n    }\n\n    handleResponse(data) {\n        Promise.resolve(this.addElementsToDOM(data))\n            .then(() => {\n                this.page++;\n                this.elementToWatch = document.getElementById(this.element).rows[document.getElementById(this.element).rows.length - this.options.loadTiming];\n                return true;\n            }).then(() => {\n                this.setupListener();\n            });\n    }\n\n    addElementsToDOM(data) {\n        data.forEach(val => {\n            let tableRef = document.getElementById(this.element).getElementsByTagName('tbody')[0];\n            let newRow = tableRef.insertRow(tableRef.rows.length);\n            Object.keys(this.options.fields).forEach((field, i) => {\n                let newCell = newRow.insertCell(i);\n                let content = document.createTextNode(val[field]);\n                newCell.appendChild(content);\n                newCell.setDataAttribute(val, this.options.fields[field].data);\n                if (this.options.fields[field].editable) {\n                    newCell.setAttribute('contenteditable', 'true');\n                        this.options.fields[field].editable.forEach(action => {\n                            newCell.addEventListener(action.on, action.handle)\n                        });\n                }\n                if (this.options.fields[field].listener) {\n                    this.options.fields[field].listener.forEach(action => {\n                        newCell.addEventListener(action.on, action.handle)\n                    });\n                }\n            });\n        });\n        return true;\n    }\n}\n\n"]}